using ReFolder.Dir.Description;
using System;
using System.Collections.Generic;

namespace ReFolder.Dir
{
    [Serializable]
    public class MainDir : Dir, IEditableDirWithChildren
    {
        public List<IEditableDirWithChildrenAndParent> Children { get; set; } = new List<IEditableDirWithChildrenAndParent>();

        #region constructors
        public MainDir(IMutableSystemObjectDescription description, List<IEditableDirWithChildrenAndParent> children) : this(description)
        {
            if (children == null) throw new ArgumentNullException("one or more arguments are null");
            this.Children = children;

        }
        public MainDir(IMutableSystemObjectDescription description) : base(description)
        {
        }
        public MainDir() { }
        #endregion
        //usuwa childDir
        public void DeleteChildDirFromList(IEditableDirWithChildrenAndParent child)
        {
            Children.Remove(child);
        }
        //usuwa childrenDiry
        public void DeleteChildrenDirsFromList(List<IEditableDirWithChildrenAndParent> children)
        {
            foreach (IEditableDirWithChildrenAndParent child in children)
            {
                DeleteChildDirFromList(child);
            }
        }
        // dodaje childDir
        public void AddChildToChildrenList(IEditableDirWithChildrenAndParent child)
        {

            if (DirValidate.IsNameExistingInChildrenDirs(this, child.Description.Name)) throw new InvalidOperationException($"folder named as {child.Description.Name}  exist in structure");
            child.ParentDir = this;
            DirManagement.AutoGenerateDirFullName(child);

            if (DirValidate.IsfolderExisting(child.Description.FullName)) throw new InvalidOperationException("you can't create folder that exist");
            Children.Add(child);
        }
        // dodaje childrenDiry
        public void AddChildrenToChildrenList(List<IEditableDirWithChildrenAndParent> children)
        {
            foreach (IEditableDirWithChildrenAndParent child in children)
            {
                AddChildToChildrenList(child);
            }
        }

        /// <summary>
        /// insert child in to Children list at the specified position
        /// </summary>
        /// <param name="children"></param>
        /// <param name="index"></param>
        public void AddChildOnSpecifiedIndex(IEditableDirWithChildrenAndParent children, int index)
        {

            Children.Insert(index, children);
        }
        /// <summary>
        /// insert children in to Children list at the specified position
        /// </summary>
        /// <param name="children"></param>
        /// <param name="index"></param>

        public void AddChildrenOnSpecifiedIndex(List<IEditableDirWithChildrenAndParent> children, int index)
        {
            Children.InsertRange(index, children);
        }
        public override bool Equals(object obj)
        {
            return obj is MainDir dir &&
                   base.Equals(obj) &&
                   EqualityComparer<List<IEditableDirWithChildrenAndParent>>.Default.Equals(Children, dir.Children);
        }
        public override int GetHashCode()
        {
            var hashCode = 812589192;
            hashCode = hashCode * -1521134295 + base.GetHashCode();
            hashCode = hashCode * -1521134295 + EqualityComparer<List<IEditableDirWithChildrenAndParent>>.Default.GetHashCode(Children);
            return hashCode;
        }
    }
}
